<!DOCTYPE html>
<html>
	<head>
		<title>Oatmeal Lite</title>
		<script>
			(function() {
				var username;
				var currentComments

				function enterChatRooms(){
					let possName = document.getElementById("nameinput").value;
					if (possName != ""){
						username = possName;
						currRoom = "general"
						document.getElementById("signin").style.display = "none";
						document.getElementById("chatmain").style.display = "block";
						fetch("http://localhost:3000?mode=adduser&name=" + username).then(checkStatus)
							.then(function(responseText){
								//successfully received data
								console.log("Successully joined chat")
							})
							.catch(function(error){//error
								console.log(error)
							});
					}
				}

				function getData(){
					fetch("http://localhost:3000?mode=getdata&name=" + username).then(checkStatus)
						.then(function(responseText){
							//successfully received data
							let serverJSON = JSON.parse(responseText);
							console.log(serverJSON)
						})
						.catch(function(error){//error
							console.log(error)
						});
				}

				function postComment(){
					fetch("http://localhost:3000?mode=postcomment&name=" + username + "&comment=" + document.getElementById("commentinput").value).then(checkStatus)
						.then(function(responseText){
							//successfully received data
							console.log("Successfully posted comment")
						})
						.catch(function(error){//error
							console.log(error)
						});
				}

				function checkStatus(response){
					if (response.status >= 200 && response.status < 300){
						return response.text();
					}else{
						return Promise.reject(new Error(response.status + ":" + response.statusText));
					}
				}

				window.onload = function(){

					document.getElementById("submitname").onclick = enterChatRooms;
					document.getElementById("nameinput").onkeypress = function(event){
						if (event.keyCode == 13){
							enterChatRooms();
						}
					}

					document.getElementById("submitcomment").onclick = postComment;
					document.getElementById("commentinput").onkeypress = function(event){
						if (event.keyCode == 13){
							postComment();
						}
					}
					setInterval(getData, 1000)

				};
			})();
		</script>
		<style>
			.hidden {
				display: none;
			}

			.shown {
				display: block;
			}

			body {
				text-align: center;
			}
		</style>
	</head>
	<body>
		<div id="signin" class="shown">
			<label>Name: <input type="text" id="nameinput" /></label>
			<button id="submitname">Get Started!</button>
		</div>
		<div id="chatmain" class="hidden">
			<h1>Welcome to the Discussion</h1>
			<h2>Currently in Chat Room: </h2>
			<div id="users">
				<div id="roomusers">
					<h3>Users in Room: </h3>
					<ul id="roomlist">
					</ul>
				</div>
				<div id="allusers">
					<h3>All Users Online: </h3>
					<ul id="alllist">
					</ul>
				</div>
			</div>
			<h3>Comments:</h3>
			<div id="commentbox">
				<ul id="commentlist">
				</ul>
			</div>
			<label>What's on your mind?: <input type="text" id="commentinput" /></label>
			<button id="submitcomment">Send</button>
		</div>
	</body>
</html>